---
title: "NYC Bike Trips"
execute:
  warning: false
  echo: true  # Ensure this is set to true if you want to see the code
  eval: true  # Ensure this is set to true to allow execution
format:
  gfm:
    preview-mode: raw
  html:
    code-fold: true
    code-summary: "Show the code"
    embed-resources: true
    toc: true
    html-math-method: plain
    theme: cosmo
  pdf:
    geometry: landscape
    echo: false
    toc: true
    number-sections: true
    documentclass: article
    header-includes:
      - \usepackage{graphicx} # for graphics support
jupyter: python3
---

# Overview

![NYC Bike Stations](img/nyc_map.png)

- [Collect & Transform](01_collect_transform.md)

- [Visualise](02_visualise.md)

This repo is based on code written for the book [Python Polars: The Definitive Guide](https://github.com/jeroenjanssens/python-polars-the-definitive-guide) by Janssens and Nieuwdorp.

# Installation

- `uv`

- `polars`
```{bash}
uv add 'polars[gpu]'
```

- `plotnine`

- `quarto` for scientific publishing

- `sphinx` for documentation

- `rust` for `polars_geo` plugin: 

* [Install Rust](https://www.rust-lang.org/tools/install) 

* Or update Rust with `rustup update`

- `maturin` for installing `polars_geo` Rust plugin: 

* [Install maturin](https://www.maturin.rs/installation.html)

* Build the plugin (see [Collect & Transform](01_collect_transform.md)); we had to update the versions of some dependencies to make it work

Testing:

- `tox` for running test suite

- `behave` for User Acceptance Testing (UAT)

- `pytest` for unit testing

# To Use Polars with GPU Engine

## Test
```{python}
import polars as pl
pl.LazyFrame({"x": [1, 2, 3]}).collect(engine=pl.GPUEngine(raise_on_fail=True))
```

## Execute
```{python}
#| execute: False
#lf.collect(engine='GPU')
```

# Development

In the `docs` directory, initialise the documentation:
```{bash}
uv run sphinx-quickstart
```

After populating the `docs` files `index.rst`, `overview.rst`, `api.rst`, add the following to the `conf.py` file:

```{python}
extensions = [
    'sphinx.ext.todo'
]

todo_include_todos = True
```

Then, build the documentation:

```{bash}
uv run make html
```

Tox: 

```{bash}
uv tool install tox
```
